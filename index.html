<!doctype html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<title>Ba-Bush-Ka</title>
		<meta name="description" content="ba bush ka babushka">
		<meta name="author" content="jacob debenedetto forrest townsend">
		<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
		<link rel="stylesheet" href="public/css/normalize.css">
		<link rel="stylesheet" href="public/css/stylesheet.css">
		<link rel='shortcut icon' type='image/x-icon' href='public/img/favicon.ico' />
	</head>
	<body>
		<div class="wrapper noselect"></div>
	
		<script type="text/javascript" src="public/js/jquery-2.1.0.js"></script>
		<script>
			//prepopulate relationships with data
            var name;
            var password;
			var matches  = [new Match(5,"doppl3r", -1), new Match(12,"dooley",1),
                            new Match(3,"ted555",-1), new Match(-3,"octodad",-1),
                            new Match(18,"roboto",2), new Match(3,"fillistake",-1),
                            new Match(-2,"richard4",-1), new Match(99,"dougle",-1)];
            
            $(document).ready(function() { 
                initLogin();
				
			});
			$(window).load(function() {  });
            
			function Match(score, target, action){ //int, string id, -1=undefined, 0=rock, 1=paper, 2=scissors
				this.score=score;
				this.target=target;
				this.action=action;
			}
			
            function initLogin(){
                //append the login forms
                $(".wrapper").append('<form class="form" id="form1" autocomplete="off">'+
                    '<input class="fade" type="text" name="name" placeholder="name">'+
                    '<input class="fade" type="password" name="password" placeholder="password">'+
                    '<input class="fade" type="submit" value="login"></form>');
                $("#form1").submit(function(e){ validateLogin(); return false; });
            }
            
            function initSearch(){
                //append the search options
                $(".wrapper").append('<form class="form" id="form2">'+
                    '<input class="fade" type="text" name="name" placeholder="friend">'+
                    '<input class="fade" type="submit" value="search"></form>');
                $("#form2").submit(function(e){ search($('#form2').find('input[name="name"]').val()); return false; });
            }
            
            function initLogout(){
                //append the logout button
                $(".wrapper").append('<form class="form" id="form3">'+
                    '<input class="fade" type="submit" value="logout"></form>');
                $("#form3").submit(function(e){ logout(); return false; });
            }
            
            function validateLogin(){
                //check the server for appropriate name and password
                if (true){
                    console.log("name: "+$('#form1').find('input[name="name"]').val());
                    console.log("password: "+$('#form1').find('input[name="password"]').val());
                    $(".wrapper").empty(); //empty the main window;
                    refreshMatches();
                }
            }
            
            function search(name){
                if (name.length <= 0) $('#form2').find('input[name="name"]').focus();
                else { console.log("searched name: "+name); alert('no matches found');  }
            }
            
            function logout(){
                $(".wrapper").empty(); //empty the main window;
                initLogin();
                alert('you have successfully logged out');
            }
            
			function selectAction(e){
				if (!$(e).closest('.match').hasClass('waiting')){
					//do stuff
					$(e).toggleClass("selected");
					$(e).closest('.match').addClass('waiting');
					//send the id to somewhere...I chose to send it to console
					console.log('targetID:'+$(e).closest('.match').find('.target').text());
					console.log('action:'+ $(e).closest('.match').find('span').index(e));
                    
                    //save the matches to the local system
                    matches[$(e).closest('.match').index()].action = $(e).closest('.match').find('span').index(e);
				}
			}
            
            function refreshMatches(){
                //append relationships into HTML code
				for (i = 0; i < matches.length; i++){
					$(".wrapper").append('<div class="match fade'+(matches[i].action > -1 ? " waiting" : "")+'">'+
						'<div class="score">'+matches[i].score+'</div>'+
						'<div class="target">'+matches[i].target+'</div>'+
						'<div class="actions"><span class="action1 fade" onclick="selectAction(this);"></span></div>'+
						'<div class="actions"><span class="action2 fade" onclick="selectAction(this);"></span></div>'+
						'<div class="actions"><span class="action3 fade" onclick="selectAction(this);"></span></div></div>');
                    $(".match").eq(i).find(".action"+(matches[i].action+1)).toggleClass("selected"); //toggle class action value
				}
                initSearch(); //append search option
                initLogout(); //append logout field
                
            }
			function isMobile(){ return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) ? true:false; }
		</script>
	</body>
</html>